!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Riddler=t():e.Riddler=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e){return null!==e&&"object"==typeof e}function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports={isObject:n,encode:o,buildURL:function(e,t){if(!t||!n(t))return e;var r=e,s=[];if(Object.keys(t).forEach((function(e){s.push(o(e)+"="+o(t[e]))})),s.length){var i=r.indexOf("#");i>-1&&(r=r.slice(0,i)),r+=(-1===r.indexOf("?")?"?":"&")+s.join("&")}return r}}},function(e,t,r){"use strict";function n(e,t){try{var r=JSON.stringify(t);localStorage.setItem(e,r)}catch(e){}}function o(e){try{localStorage.removeItem(e)}catch(e){}}r(2);var s=r(0).isObject,i=r(0).buildURL,a=r(3),l=r(4),u={CAPTCHA:"captcha",POW:"pow"},c={LOCALSTORAGE_NOT_SUPPORTED:"localstorage_not_supported",POW_NOT_SUPPORTED:"pow_not_supported",POW_NOT_SOLVED:"pow_not_solved",REQUEST_TIMEOUT:"request_timeout"},p={feature:null,url:null,resolved:function(){},error:function(){},preferredChallengeType:u.POW,fallbackChallengeType:u.CAPTCHA,challengeLifetime:600,challengeBanTimeout:1,powEvalPath:null,powSHA3Path:null,loggingEnabled:!1,debugEnabled:!1,syncStorageEnabled:!1,errorRequestsLimit:0};function h(e){var t,r,n,o,i;s(e)||(e={}),this.options=Object.assign({},p,e),this.options.syncStorageEnabled=(t=window.navigator.userAgent,r=t.indexOf("MSIE "),n=t.indexOf("Trident/"),o=t.indexOf("Edge/"),i=t.indexOf("rv:"),!(r>0?parseInt(t.substring(r+5,t.indexOf(".",r)),10):n>0?parseInt(t.substring(i+3,t.indexOf(".",i)),10):o>0&&parseInt(t.substring(o+5,t.indexOf(".",o)),10))&&e.syncStorageEnabled),this.options.loggingEnabled||(this.log=function(){}),this.challengeType=this.options.preferredChallengeType,h.proofOfWorkSupported()||(this.log(c.POW_NOT_SUPPORTED,{localStorageSupported:h.localStorageSupported(),webWorkersSupported:h.webWorkersSupported()}),this.challengeType=this.options.fallbackChallengeType),this.options.syncStorageEnabled&&window.addEventListener("storage",this.onStorageKeyUpdate.bind(this))}h.ChallengeType=u,h.Errors=c,h.localStorageSupported=function(){try{return localStorage.setItem("riddler_localstorage_support_test",!0),localStorage.removeItem("riddler_localstorage_support_test"),!0}catch(e){return!1}},h.webWorkersSupported=function(){return l.isSupported()},h.proofOfWorkSupported=function(){return h.localStorageSupported()&&h.webWorkersSupported()},h.prototype={onStorageKeyUpdate:function(e){var t,r;if(e.originalEvent.key&&(t=e.originalEvent.key.indexOf(this.getLocalStorageKey("results"))>-1,r=void 0!==e.originalEvent.newValue,t&&r)){var n=getObjectFromLocalStorage(this.getLocalStorageKey("results"));n.error||this.resolved(n.result)}},solve:function(){h.localStorageSupported()?this.retrieveChallengeFromLocalStorage():this.retrieveChallengeFromBackend()},update:function(e){e&&(this.challengeType=e),this.retrieveChallengeFromBackend()},clear:function(){o(this.getLocalStorageKey("challenge")),o(this.getLocalStorageKey("results")),o(this.getLocalStorageKey("expiresAt"))},log:function(e,t){t=t||{},Raven.captureMessage(e,{tags:t})},retrieveChallengeFromLocalStorage:function(){!function(e){var t;try{t=JSON.parse(localStorage.getItem(e))}catch(e){return{error:e,result:null}}}(this.getLocalStorageKey("expiresAt"));if(expiresAt.result&&!this.checkIsExpired(expiresAt.result)){var e=getObjectFromLocalStorage(this.getLocalStorageKey("results"));if(s(e.result))this.resolved(e.result);else{var t=getObjectFromLocalStorage(this.getLocalStorageKey("challenge"));s(t.result)?this.solveChallenge(t.result):this.retrieveChallengeFromBackend()}}else this.retrieveChallengeFromBackend()},retrieveChallengeFromBackend:function(e){var t;void 0===e&&(e=0),this.clear(),t={type:this.challengeType},this.options.debugEnabled&&(t.reduce_riddler_complexity=this.options.debugEnabled),function(e,t,r){var n=new XMLHttpRequest;n.addEventListener("load",(function(){if(n.status<200||n.status>=300)r();else{var e,o=n.response;try{e=JSON.parse(o)}catch(e){}e?t(e,n):r()}})),n.addEventListener("error",r),n.open("GET",e),n.send()}(i(this.options.url,t),function(e,t){var r,o=Date.now()/1e3+this.options.challengeLifetime;this.options.challengeKeyHeader&&(r=t.getResponseHeader(this.options.challengeKeyHeader)),n(this.getLocalStorageKey("expiresAt"),o),n(this.getLocalStorageKey("challenge"),e),this.solveChallenge(e,r)}.bind(this),this.options.errorRequestsLimit>0?function(){e>=this.options.errorRequestsLimit?this.options.error(c.REQUEST_TIMEOUT):setTimeout(this.retrieveChallengeFromBackend.bind(this,e+1),1e3*this.options.challengeBanTimeout+500*e)}.bind(this):function(){setTimeout(this.retrieveChallengeFromBackend.bind(this),1e3*this.options.challengeBanTimeout)}.bind(this))},solveChallenge:function(e,t){var r,n={resolved:this.resolved.bind(this)};this.challengeType=Object.values(e)[0].type,this.challengeType===u.CAPTCHA?(r=Object.assign({},n,{challengeKey:t}),new a(r).solve(e)):this.challengeType===u.POW&&(r=Object.assign({},n,{evalPath:this.options.powEvalPath,sha3Path:this.options.powSHA3Path,challengeKey:t}),new l(r).solve(e))},resolved:function(e){e.type!==u.POW||e.results||this.log(c.POW_NOT_SOLVED),n(this.getLocalStorageKey("results"),e),this.options.resolved(e)},getResults:function(e){if(h.localStorageSupported()){var t=getObjectFromLocalStorage(this.getLocalStorageKey("results"));t.error?e(c.LOCALSTORAGE_NOT_SUPPORTED):e(null,t.result)}else e(c.LOCALSTORAGE_NOT_SUPPORTED)},checkIsExpired:function(e){return e<Date.now()/1e3},getLocalStorageKey:function(e){return"wg-riddler-localStorage/"+this.options.feature+":"+e}},e.exports=h},function(e,t,r){"use strict";!function(){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r},writable:!0,configurable:!0});var e=Function.bind.call(Function.call,Array.prototype.reduce),t=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),r=Function.bind.call(Function.call,Array.prototype.concat);Object.values||(Object.values=function(n){return e(Object.keys(n),(function(e,o){return r(e,"string"==typeof o&&t(n,o)?[n[o]]:[])}),[])}),Object.entries||(Object.entries=function(n){return e(Object.keys(n),(function(e,o){return r(e,"string"==typeof o&&t(n,o)?[[o,n[o]]]:[])}),[])})}()},function(e,t,r){"use strict";var n=r(0).isObject,o={resolved:function(){}};function s(e){n(e)||(e={}),this.options=Object.assign({},o,e)}s.prototype={solve:function(e){var t=Object.keys(e)[0],r=e[t].url,n={};n[t]=r,this.options.resolved({type:"captcha",results:n,key:this.options.challengeKey})}},e.exports=s},function(e,t,r){"use strict";var n=r(0).isObject,o=r(5),s={resolved:function(){},evalPath:null,sha3Path:null,workersCount:navigator.hardwareConcurrency||4,workersLifetime:15,workersOffset:1};function i(e){n(e)||(e={}),this.options=Object.assign({},s,e)}i.isSupported=o.isSupported,i.prototype={solve:function(e){e=Object.entries(e),this.startedOps=0,this.doneOps=0,this.results={},e.forEach(function(e){var t,r,n=e[0],o=e[1];o.algorithm&&(t=this.makeStamp(o),r=this.makePrefix(o),this.startedOps++,this.results[n]=null,this.spawn(n,t,r))}.bind(this))},spawn:function(e,t,r){for(var n=[],s=Date.now()/1e3+this.options.workersLifetime,i=0;i<this.options.workersCount;i++)n.push({key:e,stamp:t,prefix:r,offset:this.options.workersOffset+i,step:this.options.workersCount,expiresAt:s});new o(n,{evalPath:this.options.evalPath,maxWorkers:this.options.workersCount}).require(this.options.sha3Path).race(a).then(this.resolved.bind(this))},resolved:function(e){for(var t=null,r=Object.entries(e),n=0;n<r.length;n++)if(null!==r[n][1]){t=r[n][1];break}this.results[t.key]=t.counter,++this.doneOps===this.startedOps&&(this.checkResults()?this.options.resolved({type:"pow",results:this.results,key:this.options.challengeKey}):this.options.resolved({type:"pow"}))},checkResults:function(){return Object.values(this.results).every(Boolean)},makeStamp:function(e){return[e.algorithm.version,e.complexity,e.timestamp,e.algorithm.resourse,e.algorithm.extension,e.random_string].join(":")},makePrefix:function(e){return new Array(e.complexity+1).join("0")}};var a=function(e){for(var t,r=e.key,n=e.stamp,o=e.prefix,s=e.offset,i=e.step,a=e.expiresAt,l=function(e){var t=CryptoJS.SHA3([n,e].join(":"));return 0===String(t,{outputLength:512}).indexOf(o)};;){if(s%1e3==0&&(t=void 0,t=Date.now()/1e3,a<t))return{key:r,counter:null};if(l(s))return{key:r,counter:s};s+=i}};e.exports=i},function(e,t,r){(function(t){!function(){var n=e.exports,o=!("undefined"!=typeof window&&this===window),s=s||function(e){setTimeout(e,0)},i=o?r(6):self.Worker,a="undefined"!=typeof self?self.URL?self.URL:self.webkitURL:null,l=!(!o&&!self.Worker);function u(e,t){for(var r in t||(t={}),e)void 0===t[r]&&(t[r]=e[r]);return t}function c(){this._callbacks=[],this._errCallbacks=[],this._resolved=0,this._result=null}c.prototype.resolve=function(e,t){if(e){this._resolved=2,this._result=e;for(var r=0;r<this._errCallbacks.length;++r)this._errCallbacks[r](e)}else{this._resolved=1,this._result=t;for(var n=0;n<this._callbacks.length;++n)this._callbacks[n](t)}this._callbacks=[],this._errCallbacks=[]},c.prototype.then=function(e,t){if(1!==this._resolved){if(2!==this._resolved)return e&&(this._callbacks[this._callbacks.length]=e),t&&(this._errCallbacks[this._errCallbacks.length]=t),this;t&&t(this._result)}else e&&e(this._result)};var p={evalPath:o?t+"/eval.js":null,maxWorkers:o?r(8).cpus().length:navigator.hardwareConcurrency||4,synchronous:!0,env:{},envNamespace:"env"};function h(e,t){this.data=e,this.options=u(p,t),this.operation=new c,this.operation.resolve(null,this.data),this.requiredScripts=[],this.requiredFunctions=[]}h.isSupported=function(){return l},h.prototype.getWorkerSource=function(e,t){var r="",n=0;for(o||0===this.requiredScripts.length||(r+='importScripts("'+this.requiredScripts.join('","')+'");\r\n'),n=0;n<this.requiredFunctions.length;++n)this.requiredFunctions[n].name?r+="var "+this.requiredFunctions[n].name+" = "+this.requiredFunctions[n].fn.toString()+";":r+=this.requiredFunctions[n].fn.toString();t=JSON.stringify(t||{});var s=this.options.envNamespace;return o?r+'process.on("message", function(e) {global.'+s+" = "+t+";process.send(JSON.stringify(("+e.toString()+")(JSON.parse(e).data)))})":r+"self.onmessage = function(e) {var global = {}; global."+s+" = "+t+";self.postMessage(("+e.toString()+")(e.data))}"},h.prototype.require=function(){for(var e,t=Array.prototype.slice.call(arguments,0),r=0;r<t.length;r++)"string"==typeof(e=t[r])?this.requiredScripts.push(e):"function"==typeof e?this.requiredFunctions.push({fn:e}):"object"==typeof e&&this.requiredFunctions.push(e);return this},h.prototype._spawnWorker=function(e,t){var r,n=this.getWorkerSource(e,t);if(o)(r=new i(this.options.evalPath)).postMessage(n);else{if(void 0===i)return;try{if(0!==this.requiredScripts.length){if(null===this.options.evalPath)throw new Error("Can't use required scripts without eval.js!");(r=new i(this.options.evalPath)).postMessage(n)}else{if(!a)throw new Error("Can't create a blob URL in this browser!");var s=new Blob([n],{type:"text/javascript"}),l=a.createObjectURL(s);r=new i(l)}}catch(e){if(null===this.options.evalPath)throw e;(r=new i(this.options.evalPath)).postMessage(n)}}return r},h.prototype.spawn=function(e,t){var r=this,n=new c;return t=u(this.options.env,t||{}),this.operation.then((function(){var o=r._spawnWorker(e,t);if(void 0!==o)o.onmessage=function(e){o.terminate(),r.data=e.data,n.resolve(null,r.data)},o.onerror=function(e){o.terminate(),n.resolve(e,null)},o.postMessage(r.data);else{if(!r.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");s((function(){try{r.data=e(r.data),n.resolve(null,r.data)}catch(e){n.resolve(e,null)}}))}})),this.operation=n,this},h.prototype._spawnMapWorker=function(e,t,r,n,o){var i=this;if(o||(o=i._spawnWorker(t,n)),void 0!==o)o.onmessage=function(t){i.data[e]=t.data,r(null,o)},o.onerror=function(e){o.terminate(),r(e)},o.postMessage(i.data[e]);else{if(!i.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");s((function(){i.data[e]=t(i.data[e]),r()}))}},h.prototype.map=function(e,t){if(t=u(this.options.env,t||{}),!this.data.length)return this.spawn(e,t);var r=this,n=0,o=0;function s(a,l){a?i.resolve(a,null):++o===r.data.length?(i.resolve(null,r.data),l&&l.terminate()):n<r.data.length?r._spawnMapWorker(n++,e,s,t,l):l&&l.terminate()}var i=new c;return this.operation.then((function(){for(;n-o<r.options.maxWorkers&&n<r.data.length;++n)r._spawnMapWorker(n,e,s,t)}),(function(e){i.resolve(e,null)})),this.operation=i,this},h.prototype._spawnRaceWorker=function(e,t,r){var n=this._spawnWorker(t);if(void 0===n)throw new Error("Workers do not exist!");this.workers[e]=n,n.onmessage=function(t){r(t.data,e)},n.postMessage(this.data[e])},h.prototype.race=function(e){if(!this.data.length)return this.spawn(e);var t=this;t.workers=new Array(this.data.length);var r=0;function n(e,r){for(var n=0;n<t.data.length;n++)t.data[n]=null,t.workers[n].terminate();t.data[r]=e,o.resolve(null,t.data)}var o=new c;return this.operation.then((function(){for(;r-0<t.options.maxWorkers&&r<t.data.length;++r)t._spawnRaceWorker(r,e,n)})),this.operation=o,this},h.prototype._spawnReduceWorker=function(e,t,r,n,o){var i=this;if(o||(o=i._spawnWorker(t,n)),void 0!==o)o.onmessage=function(e){i.data[i.data.length]=e.data,r(null,o)},o.onerror=function(e){o.terminate(),r(e,null)},o.postMessage(e);else{if(!i.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");s((function(){i.data[i.data.length]=t(e),r()}))}},h.prototype.reduce=function(e,t){if(t=u(this.options.env,t||{}),!this.data.length)throw new Error("Can't reduce non-array data");var r=0,n=this;function o(i,a){--r,i?s.resolve(i,null):1===n.data.length&&0===r?(n.data=n.data[0],s.resolve(null,n.data),a&&a.terminate()):n.data.length>1?(++r,n._spawnReduceWorker([n.data[0],n.data[1]],e,o,t,a),n.data.splice(0,2)):a&&a.terminate()}var s=new c;return this.operation.then((function(){if(1===n.data.length)s.resolve(null,n.data[0]);else{for(var i=0;i<n.options.maxWorkers&&i<Math.floor(n.data.length/2);++i)++r,n._spawnReduceWorker([n.data[2*i],n.data[2*i+1]],e,o,t);n.data.splice(0,2*i)}})),this.operation=s,this},h.prototype.then=function(e,t){var r=this,n=new c;return t="function"==typeof t?t:function(){},this.operation.then((function(){var o;try{e&&void 0!==(o=e(r.data))&&(r.data=o),n.resolve(null,r.data)}catch(e){t?(void 0!==(o=t(e))&&(r.data=o),n.resolve(null,r.data)):n.resolve(null,e)}}),(function(e){if(t){var o=t(e);void 0!==o&&(r.data=o),n.resolve(null,r.data)}else n.resolve(null,e)})),this.operation=n,this},n?e.exports=h:self.Parallel=h}()}).call(this,"/")},function(e,t,r){var n=r(7);function o(e){var t=this;this.process=n.fork(e),this.process.on("message",(function(e){t.onmessage&&t.onmessage({data:JSON.parse(e)})})),this.process.on("error",(function(e){t.onerror&&t.onerror(e)}))}o.prototype.onmessage=null,o.prototype.onerror=null,o.prototype.postMessage=function(e){this.process.send(JSON.stringify({data:e}))},o.prototype.terminate=function(){this.process.kill()},e.exports=o},function(e,t){},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}}])}));
//# sourceMappingURL=riddler.js.map